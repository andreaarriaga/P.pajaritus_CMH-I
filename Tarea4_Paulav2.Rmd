//////////---
title: "Tarea4"
author: "Paula Iturralde-Polit"
date: "04/11/2020"
output: html_document
---


```{r}

require(lme4)
require(nlme)
require(ggplot2)
require(sjPlot)
require(sjlabelled)
require(sjmisc)
require(jtools)


```


```{r setup, echo=TRUE}


datos <- read.csv("C:/Users/pmiturralde/Documents/Paula_mi_bitacora/Doctorado_UCR/Cursos/Ciencia_Rep/Tareas/Tarea4/Datos_tarea4.csv",header=T,sep=",")

View(datos)


```

```{r, echo=TRUE}


require(ggdag)

dagified <- dagify(D ~ H,
                   D ~ L,
                   H ~ L,
                   exposure = "H",
                   outcome = "D")

ggdag(dagified, layout = "circle") + theme_dag()


```

```{r, echo=TRUE}

tidy_dagitty(dagified)

```

## Visualizar datos

Relacion entre los tipos de degradacion de habitat y la diversidad de alelos

```{r, echo=TRUE}
#Visualize data


colnames(datos)


D = ggplot() + 
  geom_point(data = datos, aes(D, H1), color = "brown3")+
  geom_point(data = datos, aes(D, H2), color = "darkgreen")+
  geom_point(data = datos, aes(D, H3), color = "cyan4")+
  geom_point(data = datos, aes(D, H4), color = "coral1")+
  geom_point(data = datos, aes(D, H5), color = "darkorange1")+
  labs(y="Tipos de Degradacion", x="Diversidad de alelos") +
  ggtitle("Relacion entre tipos de degradacion y diversidad de alelos")+
    theme_bw()+
    theme(plot.title = element_text(hjust = 0.5))
    

D



```

Relacion entre la latitud y la degradacion del habitat


```{r, echo=TRUE}



L = ggplot() + 
  geom_point(data = datos, aes(H1, L), color = "brown3", size = 3, pch = 17)+
  geom_point(data = datos, aes(H2, L), color = "darkgreen", size = 3, pch = 17)+
  geom_point(data = datos, aes(H3, L), color = "cyan4", size = 3, pch = 17)+
  geom_point(data = datos, aes(H4, L), color = "coral1", size = 3, pch = 17)+
  geom_point(data = datos, aes(H5, L), color = "darkorange1", size = 3, pch = 17)+
  labs(y="Latitud", x="Tipos de degradacion del Habitat") +
  ggtitle("Relacion entre tipos de degradacion y latitud")+
    theme_bw()+
    theme(plot.title = element_text(hjust = 0.5))

L



```

Relacion entre la DIversidad de Alelos y la latitud

```{r, echo=TRUE}


ggplot() + 
geom_point(data = datos, aes(y = L, x = D), fill = "chocolate1", color = "black", size = 3, pch = 23)+
labs(y="Latitud", x="Diversidad de Alelos") +
  ggtitle("Relacion entre latitud y diversidad de alelos")+
  theme_bw()+
  theme(plot.title = element_text(hjust = 0.5))
  


```

## Grafico de barras: frecuencia de diversidad

```{r, echo=TRUE}


ggplot() + 
geom_bar(data = datos, aes(D), fill = "darkblue")+
  labs(y="Frecuencia", x="Diversidad de Alelos") +
  ggtitle("Disribucion de frecuencia de la diversidad de alelos")+
    theme_bw()+
    theme(plot.title = element_text(hjust = 0.5))




```

## Correccion de modelos

### Modelo 2

En el ejemplo de Silvia se plantea diferentes modelos en los que se controla por separado por cada una de las variables H (de H1 a H5). Esto puede generar un error en la interpretacion de resultados ya que caemos en la trampa de comparaciones indirectas. No podemos asumir que las variables H sean diferentes entre si ya que lo mas probable es que todas en conjunto tienen un efecto sobre la diversidad de los alelos.


Para corregir este error se plantea ahora un modelo en el que se controle por todas las variables H y tambien por la latitud. 

Sabemos que la latitud tiene un efecto directo e indirecto sobre la diversidad de alelos y tenemos que controlarla


```{r, echo=TRUE}


#Modelo donde controlamos por todas las variables de degradacion (H) y latitud (L)

M.2 <- lm(D ~ H1 + H2 + H3 + H4 + H5 + L, data = datos)
summary(M.2)
summ(M.2)


```

Los resultados indican que H1, H2 y H4 tienen un efecto significativo sobre la diversidad alelica. 

Si graficamos los valores estimados vemos que las tres variables que tienen un efecto significativo son las que estan mas alejadas del 0 y que efectivamente su efecto sobre la diversidad alelica es mayor con respecto a las otas dos variables de H


```{r, echo=TRUE}


#plot_model(M.2, colors = "darkblue")
#plot_model(M.2, transform = "plogis", show.values = TRUE, value.offset = .3, colors = "darkblue")
plot_summs(M.2, colors = "darkblue")


```
A pesar de ser un modelo que integra a todas las variables por las que controlamos, los resultados aparentan ser similares a los obtenidos con los modelos que se hicieron con cada H por separado. 

Para visualizar mejor estos resultados voy a generar graficos independientes para cada variable H de degradacion


```{r, figures-side, fig.width=6, fig.height=4,fig.show='hold', out.width="50%", dpi = 500}

require(ggstance)
require(piecewiseSEM)
require(broom.mixed)

effect_plot(M.2, pred = H1, interval = TRUE, plot.points = TRUE)
effect_plot(M.2, pred = H2, interval = TRUE, plot.points = TRUE)
effect_plot(M.2, pred = H3, interval = TRUE, plot.points = TRUE)
effect_plot(M.2, pred = H4, interval = TRUE, plot.points = TRUE)
effect_plot(M.2, pred = H5, interval = TRUE, plot.points = TRUE)
effect_plot(M.2, pred = L, interval = TRUE, plot.points = TRUE)




```

Los graficos resltan ser muy similares a los obtenidos en el modelo de Silvia, por lo que considero que es necesario hacer un modelo con interacciones entre las variables H


```{r, echo=TRUE}

M.4 <- lm(D ~ H1:H2:H3:H4:H5+L, data = datos)
summary(M.4)


```

Estos resultados tienen sentido porque ademas al hacer la interaccion ya encontramos una influencia significativa de la Latitud (L) sobre la  diversidad alelica.

Si graficamos los estumados entonces obtenemos lo siguiente:


```{r, echo=TRUE}

plot_summs(M.4, colors = "darkBlue", plot.distributions = TRUE)

```

## Tanto la latitud (L) como la interaccion de las variables H tiene una influencia sobre la diversidad alelica. 


