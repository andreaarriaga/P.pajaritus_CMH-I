---
title: "P.pajaritus_CMH-I"
author: "Andrea Arriaga-Madrigal, Paula Iturralde  y Silvia Chaves"
date:  "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
# setwd("/home/andrea/Documentos/ciencia_replicable/P.pajaritus_CMH-I")
library(lme4)
library(ggplot2)
```

```{r}
datos <- read.csv("Datos_tarea4.csv", header = TRUE)
str(datos)
as.character(datos$P)


## modelo que incluye la poblaicon como efecto aleatorio
 mod1 <- lmer(D ~ H1 + H2 + H3 + H4 + H5 + (1|P) + L, data = datos)
 # mod1
 # summary(mod1)


```

Es necesario incluir en el modelo la variación asociada a la población donde pertenece el individuo. De esta manera, es posible observar el efecto de las variables predictoras (H1, H2, H3, H4 y H5) sin que se vea enmascarada por la variación asociada a la población.



```{r}
# prueba con PCA

Hpca <- princomp(datos[,c("H1", "H2", "H3", "H4", "H5")])
# Hpca
summary(Hpca)
# str(Hpca)


## extrayendo los scrores del promer componente principal para hacerlo una nueva variable que agrupa todas las H
datos$degradacion <- Hpca$scores[,1]
```


```{r, echo= FALSE}
datos$P <- as.factor(datos$P)
datos$A <- as.factor(datos$A)


## calculando el promedio por P
prom <- aggregate(D ~ P, FUN = mean, data = datos)

# prom$degradacion <- aggregate(degradacion ~ P, FUN = mean, data = datos)


head(datos)

## grafico con los scores del PC1 como variable
ggplot(datos, aes(degradacion, D )) +
  geom_point(alpha = 0.4, aes(color = P),  show.legend = FALSE) + 
  geom_smooth(show.legend = FALSE)


## dividido por poblacion
ggplot(datos, aes(degradacion, D, color = P)) +
  geom_point(alpha = 0.5,  show.legend = FALSE) + 
  geom_smooth(method = "lm", show.legend = FALSE) + 
  theme_bw()


## dividido por año
# ggplot(datos, aes(D, degradacion, color = A)) +
#   geom_point(alpha = 0.5) + 
#   geom_smooth(method = "lm") + 
#   theme_bw()


```

Además, de acuerdo con la correlación que se observa entre los efectos fijos, se puede notar que H5 es el parámetro de degradación de hábitat que se correlacionado más en relación con la latitud (cor = -0.478)